---
title: <center> TMA4250 Spatial Statistics </center>
       <center> Project 1 -  Random Fields and Gaussian Random Fields </center>
author: "Christian Moen, Jim Totland"
date: "2/3/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(geoR)
library(MASS)
library(ggplot2)
```

# Problem 1
## a)
The positive semi-definite (PSD) property of the correlation function can be stated as follows. $\forall m \in \mathbb{Z}_+$, $\forall a_1, \ldots, a_m \in \mathbb{R}$ and $\forall \boldsymbol{s}_1, \ldots, \boldsymbol{s}_m \in \mathcal{D}$, we have

$$
\sum_{i = 1}^m \sum_{j = 1}^m a_i a_j \rho(\boldsymbol{s}_i, \boldsymbol{s}_j) \ge 0.
$$

To explain why this requirement is necessary, we observe that (in this case) $\rho(\boldsymbol{s}_i, \boldsymbol{s}_j) = \sigma^{-2}c(\boldsymbol{s}_i, \boldsymbol{s}_j)$, where $c$ is the covariance function. Consequently, 
$$
\begin{split}
\sum_{i = 1}^m \sum_{j = 1}^m a_i a_j \rho(\boldsymbol{s}_i, \boldsymbol{s}_j) &= \sigma^{-2}\sum_{i = 1}^m \sum_{j = 1}^m a_i a_j c(\boldsymbol{s}_i, \boldsymbol{s}_j) \\
&= \sigma^{-2} \mathrm{Var} \left[ \sum_{i = 1}^{m} a_i X(\boldsymbol{s_i})\right].
\end{split}
$$

Since the variance must be non-negative, it is clear that the PSD property above must be satisfied. Below, the different correlation functions are illustrated. \textcolor{red}{ingen grunn til to plots, fordi ulik varians gir samme korrelasjon?!}
```{r}
curve(1/5 * cov.spatial(x, cov.mod = "powered.exponential", cov.pars = c(5, 10), kappa = 1), 
      from = 0, to = 100, col = 2, xlab = "distance", ylab = expression(rho(h)))
curve(1/5 *cov.spatial(x, cov.mod = "powered.exponential", cov.pars = c(5, 10), kappa = 1.9), 
      from = 0, to = 100, col = 2, lwd = 2, add = TRUE)
curve(1/5 * cov.spatial(x, cov.mod = "matern", cov.pars = c(5, 20), kappa = 1), 
      from = 0, to = 100, col = 3, add = TRUE)
curve(1/5 *cov.spatial(x, cov.mod = "matern", cov.pars = c(5, 20), kappa = 3), 
      from = 0, to = 100, col = 3, lwd = 2, add = TRUE)
legend("topright", c(expression("Powered exponential, " ~alpha~ " = 1"), 
                     expression("Powered exponential, " ~alpha~ " = 1.9"),        
                     expression("Matérn, " ~nu~ " = 1"), expression("Matérn, " ~nu~ " = 3")),
       col = c(2,2,3,3), lwd = c(1,2,1,2))
```
Next, we plot the semi-variograms. \textcolor{red}{to figurer her kanskje? litt unødvendig? spør om dette.}

```{r}
semi.variogram <- function(x, ...){
  return(cov.spatial(0, ...) - cov.spatial(x, ...))
}

curve(semi.variogram(x, cov.mod = "powered.exponential", cov.pars = c(5, 10), kappa = 1), 
      from = 0, to = 100, col = 4, xlab = "distance", ylab = expression(gamma(h)))
curve(semi.variogram(x, cov.mod = "powered.exponential", cov.pars = c(5, 10), kappa = 1.9), 
      from = 0, to = 100, col = 4, lwd = 2, add = TRUE)
curve(semi.variogram(x, cov.mod = "matern", cov.pars = c(5, 20), kappa = 1), 
      from = 0, to = 100, col = 5, add = TRUE)
curve(semi.variogram(x, cov.mod = "matern", cov.pars = c(5, 20), kappa = 3), 
      from = 0, to = 100, col = 5, lwd = 2, add = TRUE)
legend("bottomright", c(expression("Powered exponential, " ~alpha~ " = 1"), 
                        expression("Powered exponential, " ~alpha~ " = 1.9"),
                        expression("Matérn, " ~nu~ " = 1"), 
                        expression("Matérn, " ~nu~ " = 3")),
       col = c(4,4,5,5), lwd = c(1,2,1,2))
```

## b)

By the definition of a GRF, $\boldsymbol{X} \sim \mathcal{N}(\boldsymbol{\mu}, \Sigma)$. The parameters are calculated from the mean- and covariance function of the GRF, such that $\boldsymbol{\mu} = \boldsymbol{0}$ and $\Sigma_{ij} = \sigma^2 \rho(\|i - j\|)$.

```{r}
n <- 50
D.tilde <- 1:n 
mu <- rep(0, n)
Sigma <- cov.spatial(as.matrix(dist(expand.grid(D.tilde))), 
                     cov.mod = "powered.exponential", cov.pars = c(5, 10), kappa = 1)
X <- mvrnorm(4, mu, Sigma)
df <- data.frame(t(X), D = D.tilde)
ggplot(df) + geom_point(aes(x = D, y = X1), color = "red") + geom_point(aes(x = D, y = X2))
plot(D.tilde, X[1,])
```





